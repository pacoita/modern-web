import{d as B}from"./chunk-EGSPEJGI.js";import"./chunk-EJGX32BV.js";import{g as D,h as z,i as H,j as Q,k as R,l as j}from"./chunk-EH3GIMEI.js";import{a as F,c as L,g as G}from"./chunk-6TMERT2D.js";import"./chunk-LAR6TP5T.js";import{Cc as T,E as y,Eb as O,Ec as I,Jb as o,K as E,Kb as a,Lb as s,Pb as v,Rb as d,Sb as m,Wb as f,Xb as w,Yb as x,ac as r,bb as S,bc as M,d as h,db as c,ib as A,jc as k,oa as _,ob as V,pa as u,sb as C,zb as g}from"./chunk-DSW3PZOY.js";var U=["videoElement"],q=["canvas"],N=["resultShot"],W=n=>({displayPhoto:n});function Y(n,p){if(n&1){let e=v();o(0,"div",18)(1,"button",20),d("click",function(){_(e);let i=m(2);return u(i.takePhoto())}),s(2,"img",21),a(),o(3,"button",20),d("click",function(){_(e);let i=m(2);return u(i.timerShot())}),s(4,"img",22),a()()}}function $(n,p){if(n&1&&(o(0,"div",14),r(1),a()),n&2){let e=m(2);c(),M(e.timerSeconds)}}function J(n,p){n&1&&(o(0,"div",14),r(1,"\u{1F642}"),a())}function K(n,p){if(n&1){let e=v();o(0,"button",20),d("click",function(){_(e);let i=m(2);return u(i.share())}),s(1,"img",23),a()}}function X(n,p){if(n&1){let e=v();o(0,"button",20),d("click",function(){_(e);let i=m(2);return u(i.savePhoto())}),s(1,"img",24),a()}}function Z(n,p){if(n&1&&(o(0,"h2",5),r(1),a(),o(2,"mat-card")(3,"mat-card-content")(4,"p"),r(5," After granting permissions to use the camera, we can take a photo immediately or with a timer (3 secs). If the browser allows it, we can save on the local file system the image taken or share it via the available native apps."),s(6,"br"),r(7," If the the DeviceOrientationEvent is supported, tilting the device forward (the device, e.g. a phone, must face down) and backward will trigger the timer function. "),a(),s(8,"br"),o(9,"div",10)(10,"div",11)(11,"video",12,0),r(13,"Media input stream not available"),a(),C(14,Y,5,0,"div",13)(15,$,2,1,"div",14)(16,J,2,0,"div",14),a(),s(17,"canvas",15,1),o(19,"div",16),s(20,"img",17,2),o(22,"div",18),C(23,K,2,0,"button",19)(24,X,2,0,"button",19),a()()()()()),n&2){let e=m();c(),M(e.errorText),c(13),g("ngIf",!!(e.videoEl!=null&&e.videoEl.srcObject)),c(),O(e.timerSeconds?15:e.timerSeconds===0?16:-1),c(4),g("ngClass",k(6,W,e.displayPhoto)),c(4),g("ngIf",e.webCapabilities[e.webCapability.share]),c(),g("ngIf",e.webCapabilities[e.webCapability.fileSystem])}}function ee(n,p){if(n&1&&(o(0,"h2"),r(1),a()),n&2){let e=m();c(),M(e.supportedText)}}function te(n,p){n&1&&(o(0,"div",25),s(1,"img",26),a(),s(2,"br")(3,"br"),o(4,"a",27),r(5,"Source: can I use"),a())}var b=function(n){return n.camera="camera",n.share="share",n.fileSystem="fileSystem",n}(b||{}),pe=(()=>{class n{constructor(e){this.titleService=e,this.displayPhoto=!1,this.webCapabilities={},this.webCapability=b,this.xValue=0,this.zValue=0,this.isActive_GAMMA=!1,this.isActive_BETA=!1,this.titleService.setTitle("Camera API"),this.webCapabilities[b.share]="share"in navigator,this.webCapabilities[b.fileSystem]="showOpenFilePicker"in window}ngOnInit(){let e=window.matchMedia("(orientation: portrait)");e.matches?this.screenOrientation="portrait":this.screenOrientation="landscape",e.addEventListener("change",t=>{t.matches?this.screenOrientation="portrait":this.screenOrientation="landscape"})}ngAfterViewInit(){return h(this,null,function*(){let e=navigator.mediaDevices;if(e){this.videoEl=this.videoElement?.nativeElement;try{let t=yield e.getUserMedia({video:!0,audio:!1});this.videoEl.srcObject=t,this.videoEl.play()}catch(t){console.error(`An error occurred while fetching the media stream: ${t}`)}}else this.supportedText="Your browser does not support the Camera API \u{1F622}"})}takePhoto(){let e=this.canvas?.nativeElement.getContext("2d"),t=this.videoEl.videoHeight/this.videoEl.videoWidth*400;this.canvas.nativeElement.width=400,this.canvas.nativeElement.height=t,e.drawImage(this.videoEl,0,0,400,t),this.displayPhoto=!0;let i=this.canvas?.nativeElement.toDataURL("image/png");this.photo?.nativeElement.setAttribute("src",i)}timerShot(e=3){y(0,1e3).pipe(E(e+2)).subscribe(t=>{this.timerSeconds=e-t,this.timerSeconds===0?this.takePhoto():this.timerSeconds<0&&(this.timerSeconds=void 0)})}savePhoto(){return h(this,null,function*(){try{this.canvas?.nativeElement.toBlob(e=>h(this,null,function*(){let i=yield(yield window.showSaveFilePicker({suggestedName:"photo_shot.jpg"})).createWritable();yield i.write(e),yield i.close()}))}catch(e){console.error(e)}})}share(){try{this.canvas?.nativeElement.toBlob(e=>h(this,null,function*(){let t=new File([e],"demo_shot.jpg",{type:"image/jpeg",lastModified:new Date().getTime()});navigator.share({title:"My photo",text:"Check out my photo",url:"https://github.com/pacoita/modern-web",files:[t]})}))}catch(e){this.errorText="An error occurred while sharing the photo",console.error(e)}}onOrientationChange(e){if(this.screenOrientation==="landscape"){this.zValue=Math.round(e.gamma??0);let t=screen.orientation.type,i=t==="landscape-primary",l=t==="landscape-secondary",P=this.zValue<=-40||this.zValue>=40;this.zValue<40&&this.zValue>0&&i||this.zValue>-40&&this.zValue<0&&l?this.isActive_GAMMA=!0:P&&this.isActive_GAMMA&&(this.isActive_GAMMA=!1,this.timerShot())}else{this.xValue=Math.round(e.beta??0);let t=this.xValue<-40&&this.xValue>-130,i=this.xValue>=-40&&this.xValue<=80;t&&(this.xValue=0),this.xValue>160?this.isActive_BETA=!0:i&&this.isActive_BETA&&(this.isActive_BETA=!1,this.timerShot())}}static{this.\u0275fac=function(t){return new(t||n)(A(B))}}static{this.\u0275cmp=V({type:n,selectors:[["app-light"]],viewQuery:function(t,i){if(t&1&&(f(U,5),f(q,5),f(N,5)),t&2){let l;w(l=x())&&(i.videoElement=l.first),w(l=x())&&(i.canvas=l.first),w(l=x())&&(i.photo=l.first)}},hostBindings:function(t,i){t&1&&d("deviceorientation",function(P){return i.onOrientationChange(P)},!1,S)},decls:26,vars:1,consts:[["videoElement",""],["canvas",""],["resultShot",""],[1,"content","container"],[1,"warn-text"],[1,"label"],[1,"descr-card"],[1,"accordion-container"],["multi","",1,"example-headers-align"],["matExpansionPanelContent",""],[1,"photo-wrap"],[1,"camera-box"],["id","video"],["id","camera-actions",4,"ngIf"],[1,"timer"],["id","temp-canvas"],["id","preview-box",3,"ngClass"],["id","photo-taken","alt","Photo preview"],["id","camera-actions"],["class","icon-button",3,"click",4,"ngIf"],[1,"icon-button",3,"click"],["src","assets/icons/camera_icon.png","width","24","height","24","alt","camera icon",1,"icon-space"],["src","assets/icons/timer.png","width","24","height","24","alt","timer icon",1,"icon-space"],["src","assets/icons/share.png","width","24","height","24","alt","share icon",1,"icon-space"],["src","assets/icons/save_black.png","width","24","height","24","alt","save icon",1,"icon-space"],[1,"img-container"],["src","assets/images/camera.png","alt","Ambient Light Sensor api support"],["href","https://caniuse.com/?search=getUserMedia","target","_blank"]],template:function(t,i){t&1&&(o(0,"section",3)(1,"div",4)(2,"h1",5),r(3,"Media Capture API"),a()(),o(4,"mat-card",6)(5,"p"),r(6," With the "),o(7,"strong"),r(8,"Media Capture and Streams API"),a(),r(9,", we can connect to devices that capture media, such as cameras and microphones. This API lets us access any hardware-based media data source on a target device. "),s(10,"br")(11,"br"),r(12," By invoking the "),o(13,"strong"),r(14,"getUserMedia()"),a(),r(15," method it is possible to get a video stream and manipulate it in different ways within our app. "),a()(),C(16,Z,25,8)(17,ee,2,1,"h2"),o(18,"div",7)(19,"mat-accordion",8)(20,"mat-expansion-panel")(21,"mat-expansion-panel-header")(22,"mat-panel-title")(23,"h1"),r(24,"Browser compatibility"),a()()(),C(25,te,6,0,"ng-template",9),a()()()()),t&2&&(c(16),O(i.supportedText?17:16))},dependencies:[T,G,F,L,I,j,R,z,H,Q,D],styles:[".warn-text[_ngcontent-%COMP%]{margin-bottom:2rem}.warn-text[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 2rem 0 0}.container[_ngcontent-%COMP%]{padding:1rem}.container[_ngcontent-%COMP%]   .photo-wrap[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap;gap:1rem;margin-bottom:1rem}.container[_ngcontent-%COMP%]   .photo-wrap[_ngcontent-%COMP%]   .camera-box[_ngcontent-%COMP%]{position:relative;width:47%}@media screen and (max-width: 850px){.container[_ngcontent-%COMP%]   .photo-wrap[_ngcontent-%COMP%]   .camera-box[_ngcontent-%COMP%]{width:100%;max-width:none}}.container[_ngcontent-%COMP%]   .photo-wrap[_ngcontent-%COMP%]   .camera-box[_ngcontent-%COMP%]   #video[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .photo-wrap[_ngcontent-%COMP%]   .camera-box[_ngcontent-%COMP%]   #temp-canvas[_ngcontent-%COMP%]{width:100%}.container[_ngcontent-%COMP%]   .photo-wrap[_ngcontent-%COMP%]   .camera-box[_ngcontent-%COMP%]   .timer[_ngcontent-%COMP%]{position:absolute;top:50%;left:40%;font-size:7rem;color:#fffefe99}.container[_ngcontent-%COMP%]   .photo-wrap[_ngcontent-%COMP%]   #preview-box[_ngcontent-%COMP%]{width:47%;position:relative;display:none}.container[_ngcontent-%COMP%]   .photo-wrap[_ngcontent-%COMP%]   #preview-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.container[_ngcontent-%COMP%]   .photo-wrap[_ngcontent-%COMP%]   #preview-box.displayPhoto[_ngcontent-%COMP%]{display:block}@media screen and (max-width: 850px){.container[_ngcontent-%COMP%]   .photo-wrap[_ngcontent-%COMP%]   #preview-box[_ngcontent-%COMP%]{width:100%}}.container[_ngcontent-%COMP%]   .photo-wrap[_ngcontent-%COMP%]   #camera-actions[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;display:flex;flex-direction:column;gap:.5rem}.container[_ngcontent-%COMP%]   .photo-wrap[_ngcontent-%COMP%]   #camera-actions[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{width:36px;height:36px;border:none;color:#fff;cursor:pointer;border-radius:50%;background-color:#0764f454}.container[_ngcontent-%COMP%]   .photo-wrap[_ngcontent-%COMP%]   #camera-actions[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]:hover{background-color:#ffed26c0}.container[_ngcontent-%COMP%]   #temp-canvas[_ngcontent-%COMP%]{display:none}"]})}}return n})();export{pe as CameraCaptureComponent};
